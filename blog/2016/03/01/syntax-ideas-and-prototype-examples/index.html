<!DOCTYPE html>
<!-- BEGIN partials/header.html -->
<html>
  <head>
    <!-- BEGIN partials/header-device.html -->
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- END partials/header-device.html -->
    
    <!-- BEGIN partials/header-page.html -->

    <title>Syntax Ideas and Prototype Examples &middot; Harth Programming Language</title>    
    <meta name="description" content="Harth Programming Language">
    <meta name="author" content="Harvey Thompson">
    <meta name="generator" content="Hugo 0.46" />
    

<!-- END partials/header-page.html -->

    <!-- BEGIN partials/header-bootstrap.html -->

    
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/bootstrap-theme.css">
    
    
    
     
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    
    
    
    <link rel="stylesheet" href="/css/pygment-solarized-dark.css">
    
    
    <link rel="stylesheet" href="/css/simple-sidebar.css">
        
    <link rel="stylesheet" href="/css/harth.css">
    
<!-- END partials/header-bootstrap.html -->

  </head>
<!-- END partials/header.html -->

<!-- BEGIN partials/post-single.html -->
<!-- BEGIN partials/body-begin.html -->
<body>
  <div class="container-fluid debug-border-red">
    <!-- BEGIN partials/topbar-global.html -->

<div class="row debug-border-black harth-topbar-global harth-row-global">

</div>

<!-- END partials/topbar-global.html -->

    <!-- BEGIN partials/topbar-local.html -->

<div class="row debug-border-black harth-topbar-local harth-row-local">

</div>

<!-- END partials/topbar-local.html -->

    <div class="row debug-border-green harth-row-mid">
      <!-- BEGIN partials/sidebar.html -->

<div class="col-sm-3 debug-border-blue harth-sidebar">
  <div class="harth-sidebar-top">
    <div class="harth-site-title">
      Harth<br>Programming<br>Language
    </div>
    <div class="harth-site-author">
      By <a href="http://www.610yesnolovely.org">Harvey Thompson</a>
    </div>
  </div>
  <div class="harth-sidebar-nav">
    <!-- BEGIN partials/sidebar-nav.html -->

<ul>
  
    <li><a href="/">Home</a></li>
  
    <li><a href="/post/">Blog</a></li>
  
    <li><a href="/license/">License</a></li>
  
</ul>
<!-- END partials/sidebar-nav.html -->

  </div>
  <div class="harth-sidebar-bot">
        <ul class="sidebar-nav">
      <li class="sidebar-nav-button">
      <a href="https://twitter.com/610yesnolovely"><i class="fa fa-twitter-square fa-3x"></i></a>
      <a href="https://github.com/harthsw"><i class="fa fa-github-square fa-3x"></i></a>
      <a href="mailto:harth-lang@harthsw.com"><i class="fa fa-envelope-square fa-3x"></i></a>
      <a href="https://bitbucket.org/harthsw"><i class="fa fa-bitbucket-square fa-3x"></i></a>
      
      
      
      
      
      <a href="" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

  </div>
</div>

<!-- END partials/sidebar.html -->

      <div class="col-sm-9 debug-border-blue harth-content">
<!-- END partials/body-begin.html -->


<div class="page-header">
  <h1 class="page-title">Syntax Ideas and Prototype Examples</h1>
</div>


<h1 id="familiar-programming-language-with-fully-reified-immutable-and-homoiconic-code-data">Familiar Programming Language with Fully Reified, Immutable, and Homoiconic code/data.</h1>

<h2 id="familiar">Familiar</h2>

<p>The syntax and text of a <a href="http://www.harth-lang.org/">Harth</a> program should be familiar to most programmers.</p>

<h2 id="reified">Reified</h2>

<p><a href="https://en.wikipedia.org/wiki/Reification_(computer_science)">Reified</a> means that all levels of the programming language model (text,
  lexical/tokens, AST, Semantic Model, Project, Binaries) are processed and available at run-time
  as ordinary data.</p>

<p>The data where possible immutable (or near enough).</p>

<h2 id="immutable">Immutable</h2>

<p><a href="https://en.wikipedia.org/wiki/Immutable_object">Immutable</a> data gives greater flexibility for shared state, caching, checksum, versioning, undo.</p>

<h2 id="homoiconic">Homoiconic</h2>

<p><a href="https://en.wikipedia.org/wiki/Homoiconicity">Homoiconic</a> means that the text, lexemes, tokens, AST, Semantic data,
Project and binaries have the same shared written syntax (in human
and/or binary) as any other language data and/or code.</p>

<p>Thus the distinction between code, data, and functionality blurs.</p>

<h1 id="text-to-semantic-flow">Text to Semantic Flow</h1>

<h2 id="input-output">Input/Output</h2>

<p>Text is read from any stream of characters and internally represented
by a <code>Char*</code>, an abstract sequence of zero or more Unicode characters.</p>

<p>Note that <code>Char</code> and <code>Sequence&lt;Lexeme&gt;</code> are immutable data structures.</p>

<h2 id="lexical-analysis">Lexical Analysis</h2>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">method</span> <span class="n">Lexer</span><span class="o">/</span><span class="n">Read</span><span class="p">(</span><span class="nl">text</span> <span class="p">:</span> <span class="n">Char</span><span class="o">*</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lexeme</span><span class="o">*</span>
</code></pre></div>
<p>Method takes some <code>text</code> of type <code>Char*</code>; a sequence of Unicode characters of any valid Unicode value.</p>

<p>The method returns <code>Lexeme*</code>; that is zero or more <code>Lexeme</code> objects.</p>

<ul>
<li>Tabs and spaces are usually only significant in determining lexeme boundaries.</li>
<li>C, C++ and shell script style comments:

<ul>
<li>C means <code>/* block */</code> (allows proper nesting)</li>
<li>C++ means <code>// line</code> (for comment to end of line)</li>
<li>Shell script means <code>#!</code> is allowed (rest of line is special script comment).</li>
</ul></li>
<li>Lexemes are any valid characters.

<ul>
<li>Escaping and UTF encodings as allowed by C, C++ and other languages:</li>
<li>Example <code>\n</code> means a literal newline, raw newlines in source are usually not significant.</li>
<li>Example <code>\r</code> means a literal carriage return, again these are ignored.</li>
<li>Internally any <code>\n</code> and/or <code>\r</code> pair or single character sequence is counted as &ldquo;end of line&rdquo;.</li>
</ul></li>
<li>Lexemes are split into several categories:

<ul>
<li><code>BuiltinToken</code>: Builtin to the language itself (eg. <code>if</code>, <code>function</code>, <code>return</code>, <code>+</code>, <code>===</code>).</li>
<li><code>NameToken</code>: Any other symbol formed of unrecognized alpha-numeric or symbol characters.</li>
<li><code>ReaderToken</code>: A special token reader, (eg. <code>&quot;text&quot;</code> is implemented as a special reader function).</li>
<li><code>CommentTrivia</code>: A comment span.</li>
<li><code>WhitespaceTrivia</code>: Any other whitespace.</li>
<li><code>ErrorTrivia</code>: Some synthetic error detected by the lexer (eg. EOF in unterminated string or comment).</li>
</ul></li>
<li>Lexemes have known start, end, and character counts (in terms of Unicode characters).</li>
<li>These start/end points can be mapped to source code file, line and columns.</li>
<li>Note that <code>Lexeme</code> and <code>Sequence&lt;Lexeme&gt;</code> are immutable data structures.</li>
</ul>

<h2 id="lexemes-to-parse-tree">Lexemes to Parse Tree</h2>

<p>The <code>Lexeme*</code> is further processed by a recursive descent parser (eventually hand written).</p>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">method</span> <span class="n">Parser</span><span class="o">/</span><span class="n">Read</span><span class="p">(</span><span class="nl">lexemes</span> <span class="p">:</span> <span class="n">Lexeme</span><span class="o">*</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NodeTree</span>
</code></pre></div>
<p>Method takes some <code>lexemes</code> of type <code>Lexeme*</code>; a sequence of zero or more <code>Lexeme</code>.</p>

<p>The method returns a <code>NodeTree</code> which represents any valid or invalid
AST tree of <code>Node</code>, essentially a view of the AST tree as a
<a href="https://www.safaribooksonline.com/library/view/language-implementation-patterns/9781680500097/f_0045.html">Homogeneous AST</a>. This view and the underlyig data in immutable.</p>

<p>This means the source text, lexeme and AST syntax tree can be easily
versioned, editted, undo using functional style immutable data
structures (which are provided by <a href="http://www.harth-lang.org/">Harth</a> in the standard library).</p>

<h2 id="semantic-analysis-of-parse-tree">Semantic Analysis of Parse Tree</h2>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">method</span> <span class="n">Semantic</span><span class="o">/</span><span class="n">Analyze</span><span class="p">(</span><span class="nl">tree</span> <span class="p">:</span> <span class="n">NodeTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SemanticModel</span>
</code></pre></div>
<p>The tree input of type <code>NodeTree</code> is converted into a static
<code>SemanticModel</code> instance; from the outside perspective this is
immutable (it&rsquo;s actually either &ldquo;frozen&rdquo; once completed and/or backed
by immutable data such as the <code>Lexeme*</code> and <code>NodeTree</code> instances).</p>

<p>Semantic Analysis is useful fairly expensive, so caching these results
might be useful both for the user of the library and the provider
(which may share some cached/immutable data as is possible).</p>

<p>Again this state can be serialized and deserialized in human or binary forms.</p>

<p>Externally the <code>SemanticModel</code> allows the programmer (and thus all
tools) to ask any semantic, syntactic, lexical, or textual question.</p>

<p>Typically the analysis phase is responsible for:</p>

<ul>
<li>Checking the syntax tree is well formed.</li>
<li>Checking there are no lexical or parsing errors.</li>
<li>Determining resolution to name bindings from their definition(s) to any reference(s).</li>
<li>Maintaining identity relationships between components (binaries, libraries).

<ul>
<li>Each component contains fully resolved (to dependent components).</li>
</ul></li>
<li>Maintaining (cached) name binding maps from def-ref lookups.

<ul>
<li>Useful for completion, documentation, searching, index etc.</li>
</ul></li>
</ul>

<p>Caching the <code>SemanticModel</code> with the equivalent previous levels allows
for almost instant restarts; the models are all checksummed/hashed for
fast comparison checks. Any tool would start by:</p>

<h2 id="startup-and-caching-model">Startup and Caching Model</h2>

<ul>
<li>Look at text model (collection of <code>Char*</code> stored in files, memory, repositories etc).</li>
<li>If this matches existing <code>Lexical</code> and/or <code>NodeTree</code> and/or <code>SemanticModel</code> read these,
ensuring they all match each other exactly.</li>
<li>If not matching, compute the updated versions and cache to disk as required.</li>
</ul>

<p>This data is also immutable and can thus be safely shared between
machines, processes, and/or threads over any connection type.</p>

<p>Essentially all tools wherever they are have the best chance of
instantly reading all source code at the highest fidelity - using the least
amount of work (at least this time). That is approaching &ldquo;Read many, write once&rdquo; levels.</p>

<h2 id="compiler-script-and-repl">Compiler, Script and REPL</h2>

<p>The backend of the Compiler essentially looks like:</p>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">method</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Eval</span><span class="p">(</span><span class="nl">text</span> <span class="p">:</span> <span class="n">Char</span><span class="o">*</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Anything</span>

<span class="n">method</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Load</span><span class="p">(</span><span class="nl">files</span> <span class="p">:</span> <span class="n">Name</span><span class="o">*</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SemanticModel</span>

<span class="n">method</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Compile</span><span class="p">(</span><span class="nl">model</span> <span class="p">:</span> <span class="n">SemanticModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span>
<span class="n">method</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Link</span><span class="p">(</span><span class="nl">project</span> <span class="p">:</span> <span class="n">Project</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Executable</span>
<span class="n">method</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Run</span><span class="p">(</span><span class="nl">exec</span> <span class="p">:</span> <span class="n">Executable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Anything</span>
</code></pre></div>
<p>A <code>Project</code> is the fully reified and homoiconic representation of an
executable program; by default it contains an immutable representation
of all semantic information, code, binaries, libraries, debug
information etc.</p>

<p>The method <code>Eval</code> is a short cut for:</p>

<ul>
<li>Lexer/Read to Parser/Read to Semantic/Analyze to Compiler/Compile to Compiler/Link to Compiler/Run.

<ul>
<li>That is text arbitary text and try to execute it Just-In-Time (JIT).</li>
<li>Suitable for implementing a REPL and/or script.</li>
<li>Additional shared state (variables, scope, etc) allowed in an &ldquo;environment&rdquo;.</li>
</ul></li>
</ul>

<p>The method <code>Load</code> allows for a number of files to be loaded into a <code>SemanticModel</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">method</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Load</span><span class="p">(</span><span class="nl">files</span> <span class="p">:</span> <span class="n">Name</span><span class="o">*</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">let</span> <span class="n">files</span> <span class="o">=</span> <span class="n">assume</span><span class="p">(</span><span class="n">IO</span><span class="o">/</span><span class="n">ReadFiles</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="n">let</span> <span class="n">trees</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">_</span> <span class="o">=&gt;</span> <span class="n">Parser</span><span class="o">/</span><span class="n">Read</span><span class="p">(</span><span class="n">Lexer</span><span class="o">/</span><span class="n">Read</span><span class="p">(</span><span class="n">_</span><span class="p">.</span><span class="n">SourceText</span><span class="p">)))</span>
    <span class="n">let</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">NodeTree</span><span class="p">.</span><span class="n">CreateProjectWith</span><span class="p">(</span><span class="n">trees</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Semantic</span><span class="o">/</span><span class="n">Analyze</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>The methods <code>Compile</code>, <code>Link</code> and <code>Run</code> allow for finer control.</p>

<h3 id="compiler">Compiler</h3>

<p>A compiler might look like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">function</span> <span class="nf">main</span><span class="p">(</span><span class="nl">args</span> <span class="p">:</span> <span class="n">String</span><span class="o">*</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">let</span> <span class="n">model</span> <span class="o">=</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Load</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="n">let</span> <span class="n">project</span> <span class="o">=</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Compile</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">let</span> <span class="n">executable</span> <span class="o">=</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Link</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
    <span class="n">match</span> <span class="p">(</span><span class="n">executable</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="nl">Error</span><span class="p">:</span> <span class="n">abort</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
    <span class="k">case</span> <span class="nl">Anything</span><span class="p">:</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Compilation success</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="script-interpreter">Script Interpreter</h3>

<p>A script interpreter might look like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">function</span> <span class="nf">main</span><span class="p">(</span><span class="nl">args</span> <span class="p">:</span> <span class="n">String</span><span class="o">*</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">let</span> <span class="n">model</span> <span class="o">=</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Load</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="n">let</span> <span class="n">project</span> <span class="o">=</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Compile</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">let</span> <span class="n">executable</span> <span class="o">=</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Link</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
    <span class="n">let</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Run</span><span class="p">(</span><span class="n">executable</span><span class="p">)</span>
    <span class="n">match</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="nl">Int</span><span class="p">:</span> <span class="k">return</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
    <span class="k">case</span> <span class="nl">Error</span><span class="p">:</span> <span class="n">abort</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
    <span class="k">case</span> <span class="nl">Anything</span><span class="p">:</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%O</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span> <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="script-interpreter-1">Script Interpreter</h3>

<p>A REPL interpreter might look like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">function</span> <span class="nf">main</span><span class="p">(</span><span class="nl">args</span> <span class="p">:</span> <span class="n">String</span><span class="o">*</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">let</span> <span class="n">input</span> <span class="o">=</span> <span class="n">IO</span><span class="o">/</span><span class="n">Stdin</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">input</span><span class="p">.</span><span class="n">EOF</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">let</span> <span class="n">text</span> <span class="o">=</span> <span class="n">input</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">(</span><span class="s">&#34;Harth&gt; &#34;</span><span class="p">)</span>
        <span class="n">let</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Compiler</span><span class="o">/</span><span class="n">Eval</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">match</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="k">case</span> <span class="nl">Error</span><span class="p">:</span> <span class="n">_</span><span class="p">.</span><span class="n">PrintStackTrace</span><span class="p">()</span>
        <span class="k">case</span> <span class="nl">Anything</span><span class="p">:</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%O</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span> <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="debugging">Debugging?</h2>

<p>The debugger essentially provides a few basic helpers on top of
semantic name and source text resolution:</p>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">method</span> <span class="n">Debugger</span><span class="o">/</span><span class="n">Location</span><span class="p">(</span><span class="nl">functionName</span> <span class="p">:</span> <span class="n">Name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Location</span>
<span class="n">method</span> <span class="n">Debugger</span><span class="o">/</span><span class="n">Location</span><span class="p">(</span><span class="nl">fileName</span> <span class="p">:</span> <span class="n">Name</span><span class="p">,</span> <span class="nl">line</span> <span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="nl">column</span> <span class="p">:</span> <span class="n">Int</span><span class="o">?</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Location</span>
<span class="n">method</span> <span class="n">Debugger</span><span class="o">/</span><span class="n">Break</span><span class="p">(</span><span class="nl">loc</span> <span class="p">:</span> <span class="n">Location</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Breakpoint</span>
</code></pre></div>
<p>The <code>Breakpoint</code> result can be modified for single shot, read/write, conditional etc.</p>

<p>Additionally the JIT and/or compiler can live insert any compiled
expression (actually a parsed <code>NodeTree</code>) into code:</p>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">method</span> <span class="n">Debugger</span><span class="o">/</span><span class="n">LiveEdit</span><span class="p">(</span><span class="nl">loc</span> <span class="p">:</span> <span class="n">Location</span><span class="p">,</span> <span class="nl">code</span> <span class="p">:</span> <span class="n">NodeTree</span><span class="p">)</span>
</code></pre></div>
<p>Since all internal data can be converted to human string with
<code>ToString()</code> and/or <code>printf</code>, a watch point might be implemented by
<code>LiveEdit</code> insertion of <code>printf()</code> for each variable and/or state.</p>

<p>Breakpoints are trivial therefore; they stop execution of all tasks under the current process except for the <code>Debugger/Task</code> instance which continues running under process control so that all other tasks can be monitored.</p>

<p>Implementations of some other fundamental functions such as
<code>Debugger/Continue()</code>, <code>Run()</code>, <code>Step()</code> and <code>Next()</code> can be
implemented using semantic information.</p>

<h2 id="backend-binary-generator">Backend Binary Generator</h2>

<p>The backend binary and object generator uses the latest <a href="http://llvm.org">LLVM</a> to
convert a <code>SemanticModel</code> into an internal set of linkage/executable
<code>LLVM/Module*</code>. These are either cached and/or written to disk as
appropriate.</p>

<h1 id="programming-language-examples">Programming Language Examples</h1>

<h2 id="example-1-hello-world">Example 1: Hello World</h2>

<p>The basic program (executable, script or REPL) is to print &ldquo;Hello World&rdquo;:</p>

<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="hl"><span class="ln">1</span><span class="n">function</span> <span class="nf">main</span><span class="p">(</span><span class="nl">_</span> <span class="p">:</span> <span class="n">String</span><span class="o">*</span><span class="p">)</span>
</span><span class="ln">2</span><span class="p">{</span>
<span class="hl"><span class="ln">3</span>    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello World!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">)</span>
</span><span class="ln">4</span><span class="p">}</span>
<span class="ln">5</span></code></pre></div>

<p>This code can be made into an executable, shell script or typed interactively at a REPL:</p>

<div class="harth-console-panel">
  <pre class="harth-console">
bash$ ls -l /usr/local/bin .
-rwxr-xr-x  1 harveyt  staff  1184 Nov 26 11:04 /usr/local/bin/harth
lrwxr-xr-x  1 harveyt  staff  1184 Nov 26 11:04 /usr/local/bin/harth-compiler -&gt; /usr/local/bin/harth
lrwxr-xr-x  1 harveyt  staff  1184 Nov 26 11:04 /usr/local/bin/hc -&gt; /usr/local/bin/harth
-rw-r--r--  1 harveyt  staff  1184 Nov 26 11:04 HelloWorld.ha
bash$ hc HelloWorld
bash$ ls -l .
-rwxr-xr-x  1 harveyt  staff  1184 Nov 26 11:04 HelloWorld
bash$ ./HelloWorld
Hello World!\n
bash$
</pre>
</div>


<h3 id="notes-for-line-1">Notes for line <strong>1</strong>:</h3>

<ul>
<li><code>function</code> denotes that a function name, type and body will appear.

<ul>
<li>There is no container, it&rsquo;s global scope.</li>
<li>This is suitable for binary, script and/or REPL.</li>
<li>The <code>package</code> and <code>import</code> are the defaults.</li>
</ul></li>
<li><code>main</code> takes only one argument, the <code>String</code> passed to the executable and/or script.</li>
<li><code>_</code> means variable value is unamed and never used. Essentially the arguments are ignored.</li>
<li><code>String*</code> means a sequence of zero or more String, it&rsquo;s like a
bounded array, but has a abstract type of <code>Sequence&lt;String&gt;</code>. See <a href="TODO">Types</a>.</li>
<li><code>main</code> has no return type written, it is intuit from the block return type. See below.</li>
<li><code>main</code> must have one of the following types, and must exist and be named at global scope:

<ul>
<li><code>(String*) -&gt; Unit</code> - arguments are passed as required, always exits success (unless <code>abort()</code>).</li>
<li><code>(String*) -&gt; Int</code> - arguments are passed as required, always exits success (unless <code>abort()</code> in whic case exits failure with error message).</li>
<li><code>() -&gt; Unit</code> - similar to above.</li>
<li><code>() -&gt; Int</code> - similar to above.</li>
</ul></li>
</ul>

<h3 id="notes-for-line-3">Notes for line <strong>3</strong>:</h3>

<ul>
<li>The body is a block (<code>BlockNode</code>) which contains <code>ExpressionNode*</code> (in this case one expression).</li>
<li>Blocks always contain expressions. The type and value of the block is that of whatever is returned.

<ul>
<li>In this case <code>printf()</code> always returns the unit/identity/void value (of type <code>Unit</code>).</li>
</ul></li>
<li>Thus the block only does something by side-effect.</li>
</ul>

<h2 id="example-2-hello-world-script">Example 2: Hello World Script</h2>

<p>A more correct and portable (to Linux, MacOS, Windows Cygwin) script should be in an executable file of any name.</p>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="cp">#!/usr/bin/env hs
</span><span class="cp"></span><span class="n">function</span> <span class="nf">main</span><span class="p">(</span><span class="nl">_</span> <span class="p">:</span> <span class="n">String</span><span class="o">*</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello World!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>The key addition is the POSIX magic <code>#!/usr/bin/env hs</code> which runs the
script text through the <code>hs</code> (aka. <code>harth-script</code>) JIT script compiler
and execution engine found on <code>$PATH</code>. The <code>#!</code> is always treated as a
comment by <a href="http://www.harth-lang.org/">Harth</a>.</p>

<div class="harth-console-panel">
  <pre class="harth-console">
bash$ ls -l /usr/local/bin $HOME/bin
-rwxr-xr-x  1 harveyt  staff  1184 Nov 26 11:04 /usr/local/bin/harth
lrwxr-xr-x  1 harveyt  staff  1184 Nov 26 11:04 /usr/local/bin/harth-script -&gt; /usr/local/bin/harth
lrwxr-xr-x  1 harveyt  staff  1184 Nov 26 11:04 /usr/local/bin/hs -&gt; /usr/local/bin/harth
-rwxr-xr-x  1 harveyt  staff  1184 Nov 26 11:04 /Users/harveyt/bin/HelloWorld
bash$ HelloWorld
Hello World!
bash$
</pre>
</div>


<div class="panel panel-danger">
  <div class="panel-heading">
    <h3 class="panel-title">
      
        TODO
      
    </h3>
  </div>
  
    <div class="panel-body">
      How to support Windows scripts portably?
    </div>
  
</div>


<h2 id="example-3-hello-world-in-repl">Example 3: Hello World In REPL</h2>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello World!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">)</span>
</code></pre></div>
<p>At an interactive <a href="http://www.harth-lang.org/">Harth</a> shell (or REPL), one can simply execute any statement, expression or program. So the above will result in:</p>

<div class="harth-console-panel">
  <pre class="harth-console">
Harth&gt; printf(&#34;Hello World!\n&#34;)
Hello World!\n
Harth&gt;
</pre>
</div>


<h3 id="example-4-the-harth-lang-collection-sequence-class">Example 4: The /Harth/Lang/Collection/Sequence class</h3>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">harth</span> <span class="mf">0.1</span>
<span class="n">package</span> <span class="o">/</span><span class="n">Harth</span><span class="o">/</span><span class="n">Lang</span><span class="o">/</span><span class="n">Collection</span>
<span class="n">import</span> <span class="o">/</span><span class="n">Harth</span><span class="o">/</span><span class="n">Lang</span><span class="o">/</span><span class="n">Core</span>

<span class="cm">/**
</span><span class="cm"> * A Sequence is an abstract finite stream of elements which can be counted, accessed by index.
</span><span class="cm"> * 
</span><span class="cm"> * New sequences can be created using Builder, Append(), Prepend() and similar functions.
</span><span class="cm"> * 
</span><span class="cm"> * Operations performance may vary from O(1) to O(n) or more. LinearSequence and IndexedSequence
</span><span class="cm"> * provide tighter bounds on performance order.
</span><span class="cm"> * 
</span><span class="cm"> * Typically most classes should internally use concrete types such as List&lt;T&gt; or Array&lt;T&gt;, but
</span><span class="cm"> * should return or accept Sequence&lt;T&gt; from methods for maximum usefulness.
</span><span class="cm"> */</span>
<span class="err">@</span><span class="k">const</span>
<span class="k">class</span><span class="err"> </span><span class="nc">Sequence</span><span class="o">&lt;</span><span class="n">out</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">extends</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="err">@</span><span class="n">abstract</span>
    <span class="n">property</span> <span class="nl">ReverseIterator</span> <span class="p">:</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>

    <span class="err">@</span><span class="n">abstract</span>
    <span class="n">property</span> <span class="nl">Builder</span> <span class="p">:</span> <span class="n">Builder</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>

    <span class="err">@</span><span class="n">abstract</span>
    <span class="n">property</span> <span class="nl">Size</span> <span class="p">:</span> <span class="n">Int32</span>

    <span class="err">@</span><span class="n">abstract</span>
    <span class="n">method</span> <span class="n">Get</span><span class="p">(</span><span class="nl">i</span> <span class="p">:</span> <span class="n">Int32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">%</span>

    <span class="err">@</span><span class="n">abstract</span> <span class="err">@</span><span class="n">covariant</span>
    <span class="n">property</span> <span class="nl">First</span> <span class="p">:</span> <span class="n">T</span><span class="o">%</span>

    <span class="err">@</span><span class="n">abstract</span> <span class="err">@</span><span class="n">covariant</span>
    <span class="n">property</span> <span class="nl">Rest</span> <span class="p">:</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;%</span>

    <span class="err">@</span><span class="n">abstract</span>
    <span class="n">property</span> <span class="nl">Last</span> <span class="p">:</span> <span class="n">T</span><span class="o">%</span>

    <span class="err">@</span><span class="n">abstract</span> <span class="err">@</span><span class="n">covariant</span>
    <span class="n">method</span> <span class="n">MakeEmpty</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>

    <span class="err">@</span><span class="n">abstract</span> <span class="err">@</span><span class="n">covariant</span>
    <span class="n">method</span> <span class="n">Append</span><span class="p">(</span><span class="nl">item</span> <span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>

    <span class="err">@</span><span class="n">abstract</span> <span class="err">@</span><span class="n">covariant</span>
    <span class="n">method</span> <span class="n">AppendAll</span><span class="p">(</span><span class="nl">items</span> <span class="p">:</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>

    <span class="err">@</span><span class="n">abstract</span> <span class="err">@</span><span class="n">covariant</span>
    <span class="n">method</span> <span class="n">Prepend</span><span class="p">(</span><span class="nl">item</span> <span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>

    <span class="err">@</span><span class="n">abstract</span> <span class="err">@</span><span class="n">covariant</span>
    <span class="n">method</span> <span class="n">PrependAll</span><span class="p">(</span><span class="nl">items</span> <span class="p">:</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>

    <span class="err">@</span><span class="n">abstract</span> <span class="err">@</span><span class="n">covariant</span>
    <span class="n">method</span> <span class="n">Reverse</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>

    <span class="err">@</span><span class="n">abstract</span> <span class="err">@</span><span class="n">covariant</span>
    <span class="n">method</span> <span class="n">Drop</span><span class="p">(</span><span class="nl">n</span> <span class="p">:</span> <span class="n">Int32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;%</span>
<span class="p">}</span>
</code></pre></div>
<p>Some things to note:</p>

<ul>
<li>Most non-builtin keywords are attributes of the form <code>@name</code>.</li>
<li>A <code>class</code> can be generic in any number of types, with covariance and contravariance.</li>
<li>A <code>class</code> can extend any one other <code>class</code> (and/or zero or more <code>types</code>).</li>
<li>An <code>@abstract</code> attribute means this class only provides an interface (might turn info a type?)</li>
<li>The <code>T%</code> type means essentially &ldquo;returns either the generic parameter type <code>T</code> or an <code>Error</code>.</li>
<li>Doxygen tags and comments are supported in some form.</li>
</ul>

<p>Non-obvious:</p>

<ul>
<li>Lack of semi-colons.

<ul>
<li>I think Rust or Julia or some other modern language gets this
pretty close to correct, the semi-colon is essentially only needed
to seperate expressions in a <code>{ a; b; }</code> style block.</li>
<li>A newline outside of any expression, but in a block is
semantically taken to mean virtual &ldquo;semicolon&rdquo;.</li>
<li>Blocks allow leading/trailing/multiple newlines (and thus
semicolons) inside, they&rsquo;re the equivalent of &ldquo;an expression that
doesn&rsquo;t actually exist&rdquo;.</li>
</ul></li>
<li>Hey, where&rsquo;s the body?</li>
</ul>

<h3 id="example-4-the-harth-lang-collection-basesequence-class">Example 4: The /Harth/Lang/Collection/BaseSequence class</h3>
<div class="highlight"><pre class="chroma"><code class="language-C++" data-lang="C++"><span class="n">harth</span> <span class="mf">0.1</span>
<span class="n">package</span> <span class="o">/</span><span class="n">Harth</span><span class="o">/</span><span class="n">Lang</span><span class="o">/</span><span class="n">Collection</span>
<span class="n">import</span> <span class="o">/</span><span class="n">Harth</span><span class="o">/</span><span class="n">Lang</span><span class="o">/</span><span class="n">Core</span>

<span class="cm">/**
</span><span class="cm"> * BaseSequence provides basic implementation of Sequence using some concrete SeqT type.
</span><span class="cm"> * Sub-classes are LinearSequence and IndexedSequence which provide different performance
</span><span class="cm"> * properties for methods; for example Get() and Size() are O(n) and O(1) respectively.
</span><span class="cm"> * 
</span><span class="cm"> * Sub-classes must at minimum must provide:
</span><span class="cm"> * - Iterator or ReverseIterator (the opposite has a default implementation)
</span><span class="cm"> * - Builder
</span><span class="cm"> * 
</span><span class="cm"> * Default implementations are provided for all other operations, though these may have terrible
</span><span class="cm"> * performance up to O(n^2). Sub-classes should really override with better performance
</span><span class="cm"> * implementations were possible.
</span><span class="cm"> */</span>
<span class="err">@</span><span class="k">const</span>
<span class="k">class</span><span class="err"> </span><span class="nc">BaseSequence</span><span class="o">&lt;</span><span class="n">out</span> <span class="n">T</span><span class="p">,</span> <span class="n">out</span> <span class="n">SeqT</span><span class="o">&gt;</span> <span class="n">extends</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="err">@</span><span class="k">override</span>
    <span class="n">property</span> <span class="nl">Iterator</span> <span class="p">:</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="n">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Reverse</span><span class="p">().</span><span class="n">ReverseIterator</span><span class="p">;}</span>
    <span class="p">}</span>

    <span class="err">@</span><span class="k">override</span>
    <span class="n">property</span> <span class="nl">ReverseIterator</span> <span class="p">:</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="n">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Reverse</span><span class="p">().</span><span class="n">Iterator</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="err">@</span><span class="k">override</span>
    <span class="n">property</span> <span class="nl">Size</span> <span class="p">:</span> <span class="n">Int32</span>
    <span class="p">{</span>
        <span class="n">get</span>
        <span class="p">{</span>
            <span class="n">var</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">_</span> <span class="n">in</span> <span class="n">self</span><span class="p">)</span>
                <span class="n">s</span><span class="o">++</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="cm">/* ... */</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Note property and method overrides.</li>
<li>Note crazy generics: means derived classes can control return type.

<ul>
<li>Probably will change as type system improves?</li>
<li>Possibly more type inference too?</li>
</ul></li>
<li>Syntax and semantics should always remain:

<ul>
<li>Flexible</li>
<li>Concise</li>
<li>Unabiguous.</li>
</ul></li>
<li>Fortunately any decent editor running the full lexical to semantic
analysis would be able to display lexical, semantic feed back, possibly on-the
fly (highlighting) and provide errors and documentation as required.

<ul>
<li>See <a href="http://www.flycheck.org">Emacs FlyCheck</a> for an example of this working in other languages pretty well.</li>
<li>Emacs basically requires a very good text to reflection system
underneath the hood. Languages such as Python and C# tend to
provide this these days. Therefore <a href="http://www.harth-lang.org/">Harth</a> must and will, builtin, free, easy.</li>
</ul></li>
</ul>

<div class="panel panel-info">
  <div class="panel-heading">
    <h3 class="panel-title">
      
        Info
      
    </h3>
  </div>
  
    <div class="panel-body">
      The TODO notes and some semi-colons have been removed from the source. Hey it&#39;s a prototype. Whatevers.
    </div>
  
</div>


<h1 id="warning">Warning</h1>

<div class="panel panel-warning">
  <div class="panel-heading">
    <h3 class="panel-title">
      
        Warning
      
    </h3>
  </div>
  
    <div class="panel-body">
      All the syntax and semantics discussed here are simplified, reality is likely to be more complex, different and changing.
    </div>
  
</div>


<!-- Local Variables: -->

<!-- indent-tabs-mode: nil -->

<!-- End: -->


<!-- BEGIN partials/disqus-comment.html -->


  <div class="harth-comment"></div>
  <div id="disqus_thread"></div>

  

  <script type="text/javascript">
  var disqus_shortname = "610yesnolovely";
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  </script>
  <noscript>
    Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered
    by Disqus.</a>
  </noscript>


<!-- END partials/disqus-comment.html -->

<!-- BEGIN partials/body-end.html -->
      </div>
    </div>
  </div>
</body>
    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-71830715-3', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    
    <script src="/js/bootstrap.min.js"></script>
    
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    
    

<!-- END partials/body-end.html -->
    
<!-- END partials/post-single.html -->

<!-- BEGIN partials/footer.html -->
</html>
<!-- END partials/footer.html -->

